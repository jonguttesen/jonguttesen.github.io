<html ng-app>
<head>
  <title>jonguttesen.github.io</title>
</head>

<body>

  <div>
    <input type="file" id="hplfilename" />
    <!--<p ng-bind="filename"></p>-->
  </div>

  <script src="https://cdn.firebase.com/js/client/2.2.1/firebase.js"></script>
  <script src="http://ajax.googleapis.com/ajax/libs/angularjs/1.2.26/angular.min.js"></script>
  <script type="text/javascript">
  
      var FORMAT_HPL_1_3 = {
        "FIELDS": [
          {"name": "ADMINCODE", "len": 3},
          {"name": "INDEX", "len": 1},
          {"name": "HPLNUMBER", "len": 8},
          {"name": "COMPLETENAME", "len": 30},
          {"name": "SHORTNAME", "len": 5},
          {"name": "ZONE", "len": 6},
          {"name": "XCOORD", "len": 10},
          {"name": "YCOORD", "len": 10},
          {"name": "ZONE1", "len": 5},
          {"name": "ZONE2", "len": 5},
          {"name": "STOPTYPE", "len": 1},
          {"name": "INTRCHNGVAL", "len": 1},
          {"name": "SPECINTRCHNGVAL", "len": 2},
          {"name": "CLASSIFICATION", "len": 1 } 
        ]
      };
      //var Firebase = require("firebase");
    
      function readSingleHPLFile(evt) {
        var f = evt.target.files[0]; 
        if (f) {
          var r = new FileReader();
          r .onload = function(e) {
            var contents = e.target.result;
            var result = {};
    	      var sstr = contents.split('\n);
            for (var i = 0; i < sstr.length; i++) {
              var str = sstr[i];
              var start = 0;
              var end = 0;
              for( var j = 0; j < FORMAT_HPL_1_3.FIELDS.length;j++) {
                start = end;
                end = begin + FORMAT_HPL_1_3.FIELDS[j].length;
                var str1 = str.substr(start, end);
                FORMAT_HPL_1_3.FIELDS[j].value = str1;
              }
            }
          }
          r.readAsText(f);
        } else { 
          alert("Failed to load file");
        }
      }
      document.getElementById("hplfilename").addEventListener("hplfilenamechange", readSingleHPLFile, false);
  </script>
</body>
</html>
